<!doctype html>
<html lang="fa">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script data-mi-early="1">
  (function(){
    try{
      var root=document.documentElement;
      var theme=localStorage.getItem('mind-islands-theme');
      if(theme==='light'||theme==='dark') root.setAttribute('data-theme', theme);
      var lang=localStorage.getItem('mind-islands-lang');
      if(lang==='en'){ root.lang='en'; root.dir='ltr'; root.setAttribute('data-lang','en'); }
      else { root.lang='fa'; root.dir='rtl'; root.setAttribute('data-lang','fa'); }
      var meta=document.querySelector('meta[name="theme-color"]');
      if(meta){ meta.setAttribute('content', (root.getAttribute('data-theme')==='light') ? '#fbfaf8' : '#070b14'); }
    }catch(e){}
  })();
  </script>
  <title>Mind Islands - Diagnostic</title>
  <style>
    body{font-family:system-ui;max-width:900px;margin:24px auto;padding:0 16px;line-height:1.7}
    code{background:#f3f3f3;padding:2px 6px;border-radius:6px}
    .ok{color:#0a7}
    .bad{color:#c30}
    .box{padding:12px 14px;border:1px solid #ddd;border-radius:12px;margin:12px 0}
  </style>
</head>
<body>
  <h1>Diagnostic</h1>
  <p>این صفحه فقط برای پیدا کردن «کجاش گیر کرده» است. اگر این هم گیر کرد، مشکل از سرور/مرورگر است نه اپ.</p>

  <div class="box" id="out">Loading…</div>

  <script>
    const out = document.getElementById('out');
    function p(html){ out.innerHTML += '<br>' + html; }
    out.innerHTML = '<b>Base URL:</b> ' + location.href;

    const checks = [
      ['./index.html','index.html'],
      ['./styles.css','styles.css'],
      ['./app.js','app.js'],
      ['./enhancements.js','enhancements.js'],
      ['./service-worker.js','service-worker.js'],
    ];

    async function head(url, label){
      const ctrl = ('AbortController' in window) ? new AbortController() : null;
      const t = ctrl ? setTimeout(()=>ctrl.abort(), 4000) : null;
      const t0 = performance.now();
      try{
        const res = await fetch(url, { method:'GET', cache:'no-store', signal: ctrl?ctrl.signal:undefined });
        if(t) clearTimeout(t);
        const dt = Math.round(performance.now()-t0);
        p(`<span class="ok">✓</span> ${label}: ${res.status} (${dt}ms) size=${res.headers.get('content-length')||'?'}`);
      }catch(e){
        if(t) clearTimeout(t);
        p(`<span class="bad">✗</span> ${label}: FAILED (${e && e.name ? e.name : 'error'})`);
      }
    }

    (async()=>{
      for(const [u,l] of checks) await head(u,l);
      p('<hr>');
      p('اگر <code>app.js</code> یا <code>styles.css</code> FAILED یا خیلی کند بود، مشکل از XAMPP/Apache/AV/Cache است.');
      p('اگر همه OK بود ولی خود اپ در index.html لود نمی‌شود، مشکل از Service Worker یا یک loop است: <code>/?nosw</code> را تست کن.');
      p('برای حذف enhancements هم: <code>/?noenh</code>');
    })();
  </script>
</body>
</html>
